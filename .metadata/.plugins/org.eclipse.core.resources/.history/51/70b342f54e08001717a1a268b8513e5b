package usuario;

import dados.Livro;

import java.sql.Array;
import java.util.ArrayList;
import java.util.GregorianCalendar;

import cadastro.CadLivros;
import utilitarios.Console;


public class Usuario {
	
	private static int opcao;
	private static Console console = new Console();
	private static Livro livro;
	
	public static void main(String[] args) {
		
		while (true){
			menu();
			opcao = console.readInt("Qual opção você deseja?: ");
			
			switch (opcao){
				case 1:
					livro = pegarDadosLivro();
					CadLivros.adicionarlivro(livro);
					break;
				case 2:
					// fazer menu com os campos que poderão ser editados
				case 3:
					excluirLivro();
					break;
				case 4:
					consultarPorCodigo();
					break;
				case 5:
					consultarPorTitulo();
					break;
				case 6:
					System.out.println("Finalizando...");
					System.exit(0);
					break;
				default:
					System.out.println("Opção não encontrada!");
					break;
			}
			if (opcao < 1 || opcao > 6){
				break;
			}
		}
	}
	
	private static void menu (){
		System.out.println("\n********  Menu: ********");
		System.out.println("1) Cadastrar novo livro");
		System.out.println("2) Alterar algum livro");
		System.out.println("3) Excluir algum livro");
		System.out.println("4) Consultar livro pelo código");
		System.out.println("5) Consultar livro pelo título");
		System.out.println("6) Sair");
	}
	
	private static void dadosLivro (Livro livro){
		
		if (livro != null){
			System.out.println("Código..........: "+ livro.getCodigo());
			System.out.println("Título..........: "+ livro.getTitulo());
			System.out.println("Autor(es).......: "); // talvez teremos que fazer um for
			for (String autor: livro.getAutor()){
				System.out.print("\t"+autor+"\n");
			}
			System.out.println("Data............: "+livro.getData().getTime()+"\n");
		}else {
			System.out.println("Nenhum livro foi encontrado!");
		}
	
	}
	
	private static Livro pegarDadosLivro (){
		int codigo;
		String titulo;
		String nome = "";
		ArrayList<String> autor = new ArrayList<String>();
		GregorianCalendar data 	= new GregorianCalendar();
		Livro livro;
		do {
			codigo = console.readInt("Digite o código do livro: ");
			if (codigo <= 0){
				System.out.println("Código inválido, deve ser positivo e maior que zero!");
				
			}
		}while(codigo <= 0);
		
		do {
			titulo = console.readLine("Digite o título do livro: ");
			
			if (titulo.length() == 0){
				System.out.println("Título inválido, não deve ser deixado em branco!");
			}
		}while(titulo.length() == 0);
		
		while(!nome.equals("0")) {
			// ver logica para permitir mais de um autor
			nome = console.readLine("Digite o nome do autor [0, para finalizar]: ");
			
			if (!nome.equals("0")){
				autor.add(nome);
			}
			
			if (autor.size() == 0){
				System.out.println("Nome inválido, não deve ser deixado em branco!");
			}
		}
		
		livro = new Livro(codigo, titulo, autor, data);
		
		return livro;
	}
	
	private static void excluirLivro (){
		Livro livro = pegarDadosLivro();
		CadLivros.excluirLivro(livro);
	}
	
	private static void consultarPorCodigo (){
		int codigo;
		do {
			codigo = console.readInt("Digite o código para busca: ");
			if (codigo <= 0){
				System.out.println("Código inválido, deve ser positivo e maior que zero!");
				
			}
		}while(codigo <= 0);
		Livro livro = CadLivros.consultaPorCodigo(codigo);
		dadosLivro(livro);
	}
	
	private static void consultarPorTitulo (){
		String titulo;
		
		do {
			titulo = console.readLine("Digite o título do livro: ");
			
			if (titulo.length() == 0){
				System.out.println("Título inválido, não deve ser deixado em branco!");
			}
		}while(titulo.length() == 0);
		
		ArrayList<Livro> livros = new ArrayList<Livro>();
		livros = CadLivros.consultaPorNome(titulo);
		dadosLivro(livro);
	}

	private static void alterarDadosLivro (){
		// Como faremos para pegar o livro?: Melhor solução seria pelo codigo
		// depois do codigo, mostrar dados e menu para escolher campo a ser modificado
		// unico que não pode ser modificado é o de codigo
		// a hora também deve ser atualizada
		int codigo;
		int opcao;
		Livro livro;
		do {
			codigo = console.readInt("Digite o código para busca: ");
			if (codigo <= 0){
				System.out.println("Código inválido, deve ser positivo e maior que zero!");
				
			}
		}while(codigo <= 0);
		livro = CadLivros.consultaPorCodigo(codigo);
		dadosLivro(livro);
		
		while (true){
			System.out.println("Qual campo deseja modificar?: ");
			System.out.println("1) Título");
			System.out.println("2) Autor(es)");
			System.out.println("3) Cancelar");
			
			opcao = console.readInt("Digite sua opção: ");
			
			switch (opcao){
				case 1:
					String titulo = console.readLine("Digite o novo título: ");
					livro.setTitulo(titulo);
					break;
				case 2:
					ArrayList<String> autores = new ArrayList<String>();
					String nome = "";
					while(!nome.equals("0")) {
						// ver logica para permitir mais de um autor
						nome = console.readLine("Digite o nome do autor [0, para finalizar]: ");
						
						if (!nome.equals("0")){
							autores.add(nome);
						}
						
						if (autores.size() == 0){
							System.out.println("Nome inválido, não deve ser deixado em branco!");
						}
					}
					livro.setAutor(autores); //adicionando campo no livro atual
					break;
				case 3:
		
					break;
				default:
					System.out.println("Opção inválida!");
					break;	
			}
			
			if (opcao == 3){
				break;
			}
		}
	}
}

/* Método main para apresentar o menu principal e antes de sair 
 * do programa imprimir mensagem de finalização.
	Métodos estáticos e privados para apresentar um menu com opções para métodos: 
	cadastrar um novo livro, alterar livro, excluir um livro, consultar o livro pelo código, 
	consultar o livro pelo nome (titulo).
*/